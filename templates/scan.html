<!DOCTYPE html>
<html>
<head>
    <title>Scan - CaneSight AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>📸 Scan Image</h1>
            <p>Upload an image for {{ mode }} analysis</p>
        </header>

        <div class="scan-container">
            <form method="POST" enctype="multipart/form-data" class="upload-form">
                <input type="hidden" name="mode" value="{{ mode }}">
                
                <div class="upload-area" id="uploadArea">
                    <h3>📁 Drag & Drop or Click to Upload</h3>
                    <p>Supported formats: JPG, PNG, GIF, BMP</p>
                    <input type="file" name="image" id="fileInput" accept="image/*" required>
                </div>
                
                <div class="preview" id="preview"></div>
                
                <button type="submit" class="btn process-btn">🔍 Process Image</button>
            </form>
            
            <div class="mode-info">
                <h3>Mode: {{ mode|title }}</h3>
                <p>
                    {% if mode == 'text' %}
                    This mode will extract and read any text found in the image.
                    {% elif mode == 'object' %}
                    This mode detects objects and obstacles in the image.
                    {% elif mode == 'currency' %}
                    This mode identifies currency denominations.
                    {% elif mode == 'color' %}
                    This mode detects dominant colors in the image.
                    {% endif %}
                </p>
            </div>
        </div>
        
        <a href="{{ url_for('home') }}" class="btn back-btn">← Back to Home</a>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const preview = document.getElementById('preview');

        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.background = 'rgba(255,255,255,0.2)';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.background = 'rgba(255,255,255,0.1)';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.background = 'rgba(255,255,255,0.1)';
            fileInput.files = e.dataTransfer.files;
            showPreview(e.dataTransfer.files[0]);
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                showPreview(e.target.files[0]);
            }
        });
        
        function showPreview(file) {
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview" style="max-width: 300px; border-radius: 10px; margin-top: 20px;">`;
                };
                reader.readAsDataURL(file);
            }
        }
    </script>
</body>
</html>